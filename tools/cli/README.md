# ai-cli - í†µí•© ëª…ë ¹ì¤„ ë„êµ¬

ì„œë²„ ëª¨ë…¸ë ˆí¬ë¥¼ ìœ„í•œ í†µí•© ëª…ë ¹ì¤„ ë„êµ¬ì…ë‹ˆë‹¤. ê°œë°œ, ë°°í¬, ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬, OpenAPI ìƒì„± ë“± ë‹¤ì–‘í•œ ì‘ì—…ì„ ê°„í¸í•˜ê²Œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸš€ ì£¼ìš” ê¸°ëŠ¥

### **AI ë¬¸ì˜ ë¶„ì„**

- **ë¬¸ì˜ ë¶„ì„**: OpenAI GPT-4o-minië¥¼ ì‚¬ìš©í•œ ê³ ê° ë¬¸ì˜ ìë™ ë¶„ì„
- **ìë™ ë‹µë³€ ìƒì„±**: ì—…ì¢…ë³„ ë§ì¶¤ ë‹µë³€ ìë™ ìƒì„±
- **ë¬¸ì˜ ë¶„ë¥˜**: ë¬¸ì˜ ìœ í˜• ìë™ ë¶„ë¥˜ (ì˜ˆì•½, ê°€ê²©, ì¼ë°˜ ë“±)
- **ìƒ˜í”Œ í…ŒìŠ¤íŠ¸**: ì—…ì¢…ë³„ ìƒ˜í”Œ ë°ì´í„°ë¡œ AI ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

### **í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬**

- **ìë™ ë³‘í•©**: `.env`, `.env.local`, `.env.{NODE_ENV}` íŒŒì¼ ìë™ ë¡œë“œ
- **ë¯¼ê° ì •ë³´ ë§ˆìŠ¤í‚¹**: SECRET, PASSWORD, KEY, TOKEN íŒ¨í„´ ìë™ ë§ˆìŠ¤í‚¹
- **í•„ìˆ˜ í‚¤ ê²€ì¦**: í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜ ëˆ„ë½ ê²€ì‚¬

### **ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬**

- **Prisma ë§ˆì´ê·¸ë ˆì´ì…˜**: `migrate deploy`, `migrate dev` ì‹¤í–‰
- **í´ë¼ì´ì–¸íŠ¸ ìƒì„±**: Prisma í´ë¼ì´ì–¸íŠ¸ ìë™ ìƒì„±
- **ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”**: ë¦¬ì…‹, ì‹œë“œ, Studio ì‹¤í–‰

### **OpenAPI ë„êµ¬**

- **ìŠ¤í‚¤ë§ˆ ê²€ì¦**: Swagger CLIë¥¼ í†µí•œ API ëª…ì„¸ ê²€ì¦
- **ë²ˆë“¤ë§**: ë¶„í• ëœ OpenAPI íŒŒì¼ì„ ë‹¨ì¼ íŒŒì¼ë¡œ í†µí•©
- **íƒ€ì… ìƒì„±**: TypeScript íƒ€ì… ì •ì˜ ìë™ ìƒì„±
- **í´ë¼ì´ì–¸íŠ¸ ìƒì„±**: API í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ ìë™ ìƒì„±

### **ë¡œì»¬ ì¸í”„ë¼ ê´€ë¦¬**

- **Docker Compose**: ì„œë¹„ìŠ¤ ì‹œì‘/ì¤‘ì§€/ë¡œê·¸ ëª¨ë‹ˆí„°ë§
- **ìŠ¤ë§ˆíŠ¸ ê²½ë¡œ íƒì§€**: ìë™ìœ¼ë¡œ ì¸í”„ë¼ ë””ë ‰í† ë¦¬ ì°¾ê¸°
- **í”„ë¡œíŒŒì¼ ì§€ì›**: ë‹¤ì–‘í•œ í™˜ê²½ë³„ ì„¤ì • ì§€ì›

### **ë°°ìŠ¤ì²œ í„°ë„ ê´€ë¦¬**

- **SSM í¬íŠ¸í¬ì›Œë”© ì œì–´**: AWS Systems Managerë¥¼ ì´ìš©í•œ í„°ë„ start/stop/status
- **ë‹¤ì¤‘ í„°ë„**: ì„¤ì • íŒŒì¼ì— ì •ì˜ëœ ì—¬ëŸ¬ í„°ë„ì„ ì¼ê´„ ì œì–´
- **ë¡œê·¸/ëŸ°íƒ€ì„ ê´€ë¦¬**: ìë™ìœ¼ë¡œ PID/ë¡œê·¸ ë””ë ‰í„°ë¦¬ ìƒì„± ë° ìƒíƒœ í™•ì¸

### **ë¶€íŠ¸ìŠ¤íŠ¸ë© (Bootstrap)**

- **ì´ˆê¸°í™” ì¼ê´„ ì‹¤í–‰**: `@ai-next/shared` ë¹Œë“œ â†’ Prisma generate/build â†’ CLI ë¹Œë“œ
- ì˜ì¡´ì„± ì„¤ì¹˜ëŠ” ì„ í–‰ í•„ìš”: `pnpm install`

## ğŸ“¦ ì„¤ì¹˜ ë° ë¹Œë“œ

### **ì˜ì¡´ì„± ì„¤ì¹˜**

```bash
pnpm install
```

### **ë¹Œë“œ**

```bash
pnpm build
```

### **ê°œë°œ ëª¨ë“œ ì‹¤í–‰**

```bash
pnpm dev
```

## ğŸ› ï¸ ì‚¬ìš©ë²•

### **ê¸°ë³¸ ëª…ë ¹ì–´**

```bash
# ë„ì›€ë§ ë³´ê¸°
ai --help

# ë²„ì „ í™•ì¸
ai --version

# íŠ¹ì • ëª…ë ¹ì–´ ë„ì›€ë§
ai ai --help
ai env --help
ai db --help
ai openapi --help
ai stack --help
```

### **AI ë¬¸ì˜ ë¶„ì„ (`ai`)**

#### **í™˜ê²½ ì„¤ì •**

ë¨¼ì € OpenAI API Keyë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •í•˜ì„¸ìš”:

```bash
export OPENAI_API_KEY="sk-your-openai-api-key"
```

ë˜ëŠ” `.env` íŒŒì¼ì— ì¶”ê°€:

```bash
OPENAI_API_KEY=sk-your-openai-api-key
```

#### **ë¬¸ì˜ ë¶„ì„**

```bash
# ì§ì ‘ ë©”ì‹œì§€ ì…ë ¥
ai ai analyze --message "ì•ˆë…•í•˜ì„¸ìš”. ë‹¤ìŒì£¼ í™”ìš”ì¼ì— ìŠ¤ì¼€ì¼ë§ ì˜ˆì•½ ê°€ëŠ¥í•œê°€ìš”?"

# íŒŒì¼ì—ì„œ ë©”ì‹œì§€ ì½ê¸°
ai ai analyze --file inquiry.txt

# ì—…ì¢… ì§€ì • (ë³‘ì›)
ai ai analyze --message "ìŒêº¼í’€ ìˆ˜ìˆ  ìƒë‹´ ì˜ˆì•½í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤" --industry PLASTIC_SURGERY

# ë¶€ë™ì‚° ì—…ì¢…
ai ai analyze --message "ê°•ë‚¨êµ¬ ì•„íŒŒíŠ¸ ì „ì„¸ 3ì–µ ì •ë„ ì°¾ê³  ìˆìŠµë‹ˆë‹¤" --industry REAL_ESTATE
```

**ì¶œë ¥ ì˜ˆì‹œ:**

```
ğŸ“‹ ë¬¸ì˜ ë¶„ì„ ì¤‘...

ì—…ì¢…: HOSPITAL
ë©”ì‹œì§€: ì•ˆë…•í•˜ì„¸ìš”. ë‹¤ìŒì£¼ í™”ìš”ì¼ì— ìŠ¤ì¼€ì¼ë§ ì˜ˆì•½ ê°€ëŠ¥í•œê°€ìš”?

âœ… ë¶„ì„ ì™„ë£Œ

ì²˜ë¦¬ ì‹œê°„: 1234ms
ë¬¸ì˜ ìœ í˜•: ì˜ˆì•½ ë¬¸ì˜
ìš”ì•½: ë‹¤ìŒì£¼ í™”ìš”ì¼ ìŠ¤ì¼€ì¼ë§ ì˜ˆì•½ ë¬¸ì˜
ê°ì •: positive
ê¸´ê¸‰ë„: medium
ì‹ ë¢°ë„: 0.95

ì¶”ì¶œ ì •ë³´:
{
  "desired_date": "2025-11-19",
  "desired_time": "ë¯¸ì§€ì •",
  "treatment_name": "ìŠ¤ì¼€ì¼ë§",
  "customer_name": null,
  "contact": null
}

ì¶”ì²œ ë‹µë³€:
ë„¤, ë‹¤ìŒì£¼ í™”ìš”ì¼ ìŠ¤ì¼€ì¼ë§ ì˜ˆì•½ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì˜¤ì „ê³¼ ì˜¤í›„ ì¤‘ ì„ í˜¸í•˜ì‹œëŠ” ì‹œê°„ëŒ€ë¥¼ ì•Œë ¤ì£¼ì‹œë©´ ì˜ˆì•½ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
```

#### **ìë™ ë‹µë³€ ìƒì„±**

```bash
# ê¸°ë³¸ ë‹µë³€ ìƒì„±
ai ai reply --message "ì„í”Œë€íŠ¸ ë¹„ìš©ì´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?"

# ì»¨í…ìŠ¤íŠ¸ì™€ í•¨ê»˜ ë‹µë³€ ìƒì„±
ai ai reply \
  --message "ê°€ê²©ì´ ë„ˆë¬´ ë¹„ì‹¼ ê²ƒ ê°™ì€ë°ìš”" \
  --context "ì´ì „ ë¬¸ì˜: ì„í”Œë€íŠ¸ ë¹„ìš© ë¬¸ì˜, ë‹µë³€: ê°œë‹¹ 150ë§Œì›ì…ë‹ˆë‹¤" \
  --industry DENTAL
```

**ì¶œë ¥ ì˜ˆì‹œ:**

```
ğŸ’¬ ë‹µë³€ ìƒì„± ì¤‘...

ì—…ì¢…: DENTAL
ë©”ì‹œì§€: ì„í”Œë€íŠ¸ ë¹„ìš©ì´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?

âœ… ë‹µë³€ ìƒì„± ì™„ë£Œ

ë‹µë³€:
ì•ˆë…•í•˜ì„¸ìš”. ì„í”Œë€íŠ¸ ë¹„ìš©ì€ ê°œë‹¹ ì•½ 120ë§Œì›~150ë§Œì›ì´ë©°, ì •í™•í•œ ë¹„ìš©ì€ ìƒë‹´ í›„ ì•ˆë‚´ë“œë¦¬ê³  ìˆìŠµë‹ˆë‹¤. ë°©ë¬¸ ìƒë‹´ ì˜ˆì•½ì„ ë„ì™€ë“œë¦´ê¹Œìš”?
```

#### **ë¬¸ì˜ ë¶„ë¥˜**

```bash
# ë¬¸ì˜ ìœ í˜• ìë™ ë¶„ë¥˜
ai ai classify --message "ì¹˜ì•„ê°€ ë„ˆë¬´ ì•„íŒŒì„œ ê¸‰í•œë° ì˜¤ëŠ˜ ì§„ë£Œ ê°€ëŠ¥í•œê°€ìš”?"
```

**ì¶œë ¥ ì˜ˆì‹œ:**

```
ğŸ·ï¸  ë¬¸ì˜ ë¶„ë¥˜ ì¤‘...

ë©”ì‹œì§€: ì¹˜ì•„ê°€ ë„ˆë¬´ ì•„íŒŒì„œ ê¸‰í•œë° ì˜¤ëŠ˜ ì§„ë£Œ ê°€ëŠ¥í•œê°€ìš”?

âœ… ë¶„ë¥˜ ì™„ë£Œ

ë¶„ë¥˜ ê²°ê³¼: ê¸´ê¸‰
```

#### **ìƒ˜í”Œ í…ŒìŠ¤íŠ¸**

ì—…ì¢…ë³„ ìƒ˜í”Œ ë°ì´í„°ë¡œ AI ì„±ëŠ¥ì„ ì¼ê´„ í…ŒìŠ¤íŠ¸:

```bash
# ë³‘ì› ìƒ˜í”Œ í…ŒìŠ¤íŠ¸
ai ai test --industry HOSPITAL

# ë¶€ë™ì‚° ìƒ˜í”Œ í…ŒìŠ¤íŠ¸
ai ai test --industry REAL_ESTATE

# ì„±í˜•ì™¸ê³¼ ìƒ˜í”Œ í…ŒìŠ¤íŠ¸
ai ai test --industry PLASTIC_SURGERY
```

**ì¶œë ¥ ì˜ˆì‹œ:**

```
ğŸ§ª ìƒ˜í”Œ í…ŒìŠ¤íŠ¸ ì‹œì‘

ì—…ì¢…: HOSPITAL

â”â”â” ìƒ˜í”Œ 1/3 â”â”â”
ë¬¸ì˜: ì•ˆë…•í•˜ì„¸ìš”. ë‹¤ìŒì£¼ í™”ìš”ì¼ì— ìŠ¤ì¼€ì¼ë§ ì˜ˆì•½ ê°€ëŠ¥í•œê°€ìš”? ì˜¤ì „ ì‹œê°„ëŒ€ë¡œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ìœ í˜•: ì˜ˆì•½ ë¬¸ì˜
ìš”ì•½: ë‹¤ìŒì£¼ í™”ìš”ì¼ ì˜¤ì „ ìŠ¤ì¼€ì¼ë§ ì˜ˆì•½ ìš”ì²­
ê¸´ê¸‰ë„: medium
ë‹µë³€: ë„¤, ë‹¤ìŒì£¼ í™”ìš”ì¼ ì˜¤ì „ ìŠ¤ì¼€ì¼ë§ ì˜ˆì•½ ê°€ëŠ¥í•©ë‹ˆë‹¤...

â”â”â” ìƒ˜í”Œ 2/3 â”â”â”
...
```

#### **ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ í™•ì¸**

í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ AI ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ë¥¼ í™•ì¸:

```bash
# ë³‘ì› í”„ë¡¬í”„íŠ¸ í™•ì¸
ai ai prompt --industry HOSPITAL

# ë¶€ë™ì‚° í”„ë¡¬í”„íŠ¸ í™•ì¸
ai ai prompt --industry REAL_ESTATE
```

#### **ì§€ì›í•˜ëŠ” ì—…ì¢… (Industry Types)**

- `HOSPITAL` - ë³‘ì›/ì˜ì› (ê¸°ë³¸ê°’)
- `DENTAL` - ì¹˜ê³¼
- `DERMATOLOGY` - í”¼ë¶€ê³¼
- `PLASTIC_SURGERY` - ì„±í˜•ì™¸ê³¼
- `REAL_ESTATE` - ë¶€ë™ì‚°

### **í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬ (`env`)**

#### **í™˜ê²½ë³€ìˆ˜ ì¶œë ¥**

```bash
# ëª¨ë“  í™˜ê²½ë³€ìˆ˜ ì¶œë ¥ (ë¯¼ê° ì •ë³´ ë§ˆìŠ¤í‚¹)
ai env

# ë˜ëŠ” ëª…ì‹œì ìœ¼ë¡œ
ai env print
```

**ì¶œë ¥ ì˜ˆì‹œ:**

```
â€¢ Effective ENV (merged):
DATABASE_URL=postgresql://user:pass@localhost:5432/db
NODE_ENV=development
ai_DB_SLOW_MS=200
SECRET_KEY=***
JWT_SECRET=***
```

#### **í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜ ê²€ì¦**

```bash
# ì „ì²´(ê¸°ë³¸)
ai env --check

# íƒ€ê¹ƒë³„ ê²€ì‚¬
ai env --check --target api
ai env --check --target prisma
```

**ê²€ì¦ ëŒ€ìƒ:**

- `--target prisma`: `NODE_ENV`, `DATABASE_URL`, `ai_DB_STMT_TIMEOUT_MS`, `ai_DB_SLOW_MS`, `ai_DB_DEADLOCK_RETRY`
- `--target api`: ì „ì²´ API ìŠ¤í‚¤ë§ˆ(ì˜ˆ: `DATABASE_URL`, `JWT_ACCESS_SECRET`, `ai_LOG_*`, `RATE_*`, ë“±)

**ê²€ì¦ ì‹¤íŒ¨ ì‹œ:**

```bash
Missing required env: DATABASE_URL
# í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ (exit code 1)
```

### **ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ (`db`)**

#### **ê¸°ë³¸ ë§ˆì´ê·¸ë ˆì´ì…˜**

```bash
# ê¸°ë³¸ ë§ˆì´ê·¸ë ˆì´ì…˜ (deploy)
ai db

# ë˜ëŠ” ëª…ì‹œì ìœ¼ë¡œ
ai db migrate
```

#### **ê°œë°œìš© ë§ˆì´ê·¸ë ˆì´ì…˜**

```bash
# ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± (ì´ë¦„ í•„ìˆ˜)
ai db create --name add_user_profile

# ë¡œì»¬ DBì— ì¦‰ì‹œ ì ìš©í•˜ë©° ìƒì„±
ai db dev --name add_user_profile
```

#### **Prisma í´ë¼ì´ì–¸íŠ¸ ìƒì„±**

```bash
ai db generate
```

#### **ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”**

```bash
# âš ï¸ ì£¼ì˜: ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤
ai db reset
```

#### **Prisma Studio ì‹¤í–‰**

```bash
# ë°ì´í„°ë² ì´ìŠ¤ GUI ë„êµ¬ ì‹¤í–‰
ai db studio
```

#### **ì‹œë“œ ë°ì´í„° ì‚½ì…**

```bash
ai db seed
```

### **OpenAPI ë„êµ¬ (`openapi`)**

InquAire API Serverì˜ OpenAPI ë¬¸ì„œë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.

#### **ì „ì²´ ì‘ì—… ì‹¤í–‰**

```bash
# ìƒì„± + ê²€ì¦
ai openapi

# ë˜ëŠ” ëª…ì‹œì ìœ¼ë¡œ
ai openapi all
```

**ì¶œë ¥ ì˜ˆì‹œ:**

```
ğŸ“š InquAire API Server - OpenAPI ë¬¸ì„œ ê´€ë¦¬

â”â”â” OpenAPI ë¬¸ì„œ ìƒì„± â”â”â”

âœ… OpenAPI JSON ìƒì„± ì™„ë£Œ: /path/to/docs/api/openapi.json

ìƒì„±ëœ íŒŒì¼:
  - openapi.json
  - openapi-v0.1.0.json
  - openapi-2025-11-16.json

â”â”â” OpenAPI ë¬¸ì„œ ê²€ì¦ â”â”â”

âœ… OpenAPI ë¬¸ì„œ ê²€ì¦ ì™„ë£Œ

âœ… OpenAPI ì‘ì—… ì™„ë£Œ!

ë‹¤ìŒ ë‹¨ê³„:
  - Swagger UI í™•ì¸: ai openapi serve
  - JSON íŒŒì¼ ìœ„ì¹˜: docs/api/openapi.json
```

#### **ê°œë³„ ì‘ì—… ì‹¤í–‰**

```bash
# OpenAPI JSON ìƒì„±ë§Œ
ai openapi generate

# OpenAPI ë¬¸ì„œ ê²€ì¦ë§Œ
ai openapi validate

# Swagger UI ì„œë²„ ì‹¤í–‰
ai openapi serve
```

#### **Swagger UI ì‚¬ìš©**

```bash
# ê°œë°œ ì„œë²„ ì‹¤í–‰ (Swagger UI í¬í•¨)
ai openapi serve
```

ì„œë²„ ì‹¤í–‰ í›„ ì ‘ì†:

- **Swagger UI**: http://localhost:3000/api/docs
- **API ì—”ë“œí¬ì¸íŠ¸**: http://localhost:3000/api

#### **ìƒì„±ëœ íŒŒì¼**

OpenAPI ë¬¸ì„œëŠ” `apps/inquaire-api-server/docs/api/` ë””ë ‰í† ë¦¬ì— ìƒì„±ë©ë‹ˆë‹¤:

- `openapi.json` - ìµœì‹  ë²„ì „
- `openapi-v{version}.json` - ë²„ì „ë³„ ì•„ì¹´ì´ë¸Œ
- `openapi-{date}.json` - ë‚ ì§œë³„ ìŠ¤ëƒ…ìƒ·

#### **í´ë¼ì´ì–¸íŠ¸ SDK ìƒì„±**

ìƒì„±ëœ OpenAPI JSONìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ SDKë¥¼ ìë™ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
# TypeScript/Axios í´ë¼ì´ì–¸íŠ¸
npx @openapitools/openapi-generator-cli generate \
  -i apps/inquaire-api-server/docs/api/openapi.json \
  -g typescript-axios \
  -o clients/typescript

# Python í´ë¼ì´ì–¸íŠ¸
npx @openapitools/openapi-generator-cli generate \
  -i apps/inquaire-api-server/docs/api/openapi.json \
  -g python \
  -o clients/python
```

### **ë¡œì»¬ ì¸í”„ë¼ ê´€ë¦¬ (`stack`)**

#### **Docker ì„œë¹„ìŠ¤ ì‹œì‘**

```bash
# ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì„œë¹„ìŠ¤ ì‹œì‘
ai stack

# ë˜ëŠ” ëª…ì‹œì ìœ¼ë¡œ
ai stack up
```

#### **Docker ì„œë¹„ìŠ¤ ì¤‘ì§€**

```bash
ai stack down
```

#### **ë¡œê·¸ ëª¨ë‹ˆí„°ë§**

```bash
# ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸
ai stack logs

# íŠ¹ì • ì„œë¹„ìŠ¤ ë¡œê·¸ë§Œ
ai stack logs --service redis --service postgres
```

#### **ê³ ê¸‰ ì˜µì…˜**

```bash
# íŠ¹ì • compose íŒŒì¼ ì‚¬ìš©
ai stack up --file docker-compose.prod.yml

# í”„ë¡œíŒŒì¼ ì§€ì •
ai stack up --profile production

# íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ì‹œì‘
ai stack up --service redis --service postgres

# ìƒì„¸ ì •ë³´ ì¶œë ¥
ai stack up --verbose
```

### **ë°°ìŠ¤ì²œ í„°ë„ ê´€ë¦¬ (`bastion`)**

AWS Systems Manager(Session Manager)ë¥¼ ì´ìš©í•´ ë°°ìŠ¤ì²œ í„°ë„ì„ ì‹œì‘Â·ì¤‘ì§€Â·ìƒíƒœ í™•ì¸í•©ë‹ˆë‹¤. ê¸°ë³¸ ì„¤ì • íŒŒì¼ì€ ì €ì¥ì†Œì˜ `packages/cli/config/bastion-tunnels.conf`ì´ë©°, ì„œë²„ ì „ì—­ ì„¤ì •(`/etc/bastion/tunnels.conf`)ë„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
# ê¸°ë³¸ ë™ì‘: ìƒíƒœ í™•ì¸
ai bastion

# í„°ë„ ì œì–´
ai bastion start
ai bastion stop
ai bastion restart

# ì»¤ìŠ¤í…€ ì„¤ì •/ë””ë ‰í„°ë¦¬ ì§€ì •
ai bastion start --config ./scripts/bastion/tunnels.conf \
  --runtime-dir ~/.cache/bastion/run \
  --log-dir ~/.cache/bastion/log
```

**ì£¼ìš” í™˜ê²½ ë³€ìˆ˜**

- `CONFIG_FILE`: ì„¤ì • íŒŒì¼ ê²½ë¡œ (ê¸°ë³¸ `tools/cli/config/bastion-tunnels.conf`, ì—†ìœ¼ë©´ `/etc/bastion/tunnels.conf`)
- `RUNTIME_DIR`: PID íŒŒì¼ ì €ì¥ ìœ„ì¹˜ (ê¸°ë³¸ `~/.cache/bastion-tunnels/run`)
- `LOG_DIR`: ë¡œê·¸ íŒŒì¼ ì €ì¥ ìœ„ì¹˜ (ê¸°ë³¸ `~/.cache/bastion-tunnels/log`)
- `BASTION_TARGET`, `AWS_PROFILE`, `AWS_REGION`: ì„¤ì • íŒŒì¼ ê°’ì„ ì¼ì‹œì ìœ¼ë¡œ ë®ì–´ì“¸ ë•Œ ì‚¬ìš©

**Read Replica ì‚¬ìš©í•˜ê¸°**

í”„ë¡œë•ì…˜ ì„¤ì • íŒŒì¼(`bastion-tunnels-production.conf`)ì—ëŠ” Read Replica í„°ë„ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

- **Write DB**: `localhost:45432` â†’ `DATABASE_URL`
- **Read Replica**: `localhost:25432` â†’ `READ_DATABASE_URL`
- **Redis**: `localhost:16379` â†’ `REDIS_URL`

ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œ Read Replicaë¥¼ ì‚¬ìš©í•˜ë ¤ë©´:

1. **í„°ë„ ì‹œì‘**:

   ```bash
   BASTION_ENV=production ai bastion start
   ```

2. **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •** (`apps/api-server/envs/.env.local` ë˜ëŠ” í™˜ê²½ ë³€ìˆ˜):

   ```bash
   # Write DB (í•„ìˆ˜)
   DATABASE_URL=postgresql://user:password@localhost:45432/dbname

   # Read Replica (ì„ íƒì , í„°ë„ì´ ì—°ê²°ëœ ê²½ìš°)
   READ_DATABASE_URL=postgresql://user:password@localhost:25432/dbname
   ```

3. **ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©**:

   ```typescript
   // ì½ê¸° ì‘ì—…: Read Replica ì‚¬ìš© (ì„¤ì •ëœ ê²½ìš°)
   const users = await prisma.read.user.findMany();

   // ì“°ê¸° ì‘ì—…: Write DB ì‚¬ìš©
   const user = await prisma.write.user.create({ data: {...} });
   ```

ì„¤ì • í…œí”Œë¦¿ê³¼ ì˜ˆì‹œëŠ” `deploy/api-server/README.md`ì˜ ì‹œí¬ë¦¿/í™˜ê²½ ë³€ìˆ˜ ì•ˆë‚´ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

### **ë¶€íŠ¸ìŠ¤íŠ¸ë© ì‹¤í–‰ (`bootstrap`)**

```bash
# ì˜ì¡´ì„± ì„¤ì¹˜ í›„ ì´ˆê¸° ë¹Œë“œ/ìƒì„± ì‘ì—… ì¼ê´„ ìˆ˜í–‰
ai bootstrap
```

**ìˆ˜í–‰ í•­ëª©:**

- `@ai-next/shared` ë¹Œë“œ
- `@ai-next/prisma` í´ë¼ì´ì–¸íŠ¸ ìƒì„± (`prisma generate`)
- `@ai-next/prisma` ë¹Œë“œ
- `ai-cli` ë¹Œë“œ

## ğŸ”§ ìƒì„¸ API ë¬¸ì„œ

### **1. ë©”ì¸ CLI ì§„ì…ì **

#### **ëª…ë ¹ì–´ êµ¬ì¡°**

```typescript
// packages/cli/src/index.ts
const program = new Command();
program.name('ai')
  .description('InquAire Monorepo CLI')
  .version('0.1.0');

// í•˜ìœ„ ëª…ë ¹ì–´ ë“±ë¡
program.command('env')...
program.command('db')...
program.command('openapi')...
program.command('stack')...
```

#### **ì—ëŸ¬ ì²˜ë¦¬**

```typescript
program.parseAsync().catch(e => {
  console.error(e);
  process.exit(1);
});
```

### **2. í™˜ê²½ë³€ìˆ˜ ëª…ë ¹ì–´ (`env`)**

#### **ëª…ë ¹ì–´ ì˜µì…˜**

```typescript
program
  .command('env')
  .description('í™˜ê²½ë³€ìˆ˜ ìœ í‹¸ë¦¬í‹°')
  .option('-c, --check', 'í•„ìˆ˜ í‚¤ ê²€ì‚¬')
  .action(async opts => {
    await cmdEnv(opts.check ? 'check' : 'print');
  });
```

#### **ë™ì‘ ëª¨ë“œ**

- **`print` (ê¸°ë³¸)**: ë³‘í•©ëœ í™˜ê²½ë³€ìˆ˜ ì¶œë ¥
- **`check`**: í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜ ëˆ„ë½ ê²€ì‚¬

#### **ë¯¼ê° ì •ë³´ ë§ˆìŠ¤í‚¹**

```typescript
const masked = /SECRET|PASSWORD|KEY|TOKEN/i.test(k) ? '***' : v;
```

**ë§ˆìŠ¤í‚¹ íŒ¨í„´:**

- `SECRET` - ì‹œí¬ë¦¿ í‚¤
- `PASSWORD` - ë¹„ë°€ë²ˆí˜¸
- `KEY` - ì•”í˜¸í™” í‚¤
- `TOKEN` - ì¸ì¦ í† í°

### **3. ë°ì´í„°ë² ì´ìŠ¤ ëª…ë ¹ì–´ (`db`)**

#### **ì§€ì›í•˜ëŠ” ì•¡ì…˜**

```typescript
type DbAction = 'migrate' | 'generate' | 'reset' | 'studio' | 'seed' | 'dev';
```

#### **ëª…ë ¹ì–´ ì˜µì…˜**

```typescript
program
  .command('db')
  .description('Prisma DB ì‘ì—…')
  .argument('[action]', 'migrate|generate|reset|studio|seed|dev', 'migrate')
  .option('--name <name>', 'migrate dev name')
  .action(async (action, options) => {
    await cmdDb(action, options);
  });
```

#### **ê° ì•¡ì…˜ë³„ ë™ì‘**

```typescript
export async function cmdDb(action: DbAction = 'migrate', opts?: { name?: string }) {
  const cwd = aiG_PRISMA;

  switch (action) {
    case 'dev':
      const args = ['prisma', 'migrate', 'dev'];
      if (opts?.name) args.push('--name', opts.name);
      await sh('pnpm', args, { cwd });
      break;
    case 'migrate':
      await sh('pnpm', ['prisma', 'migrate', 'deploy'], { cwd });
      break;
    case 'generate':
      await sh('pnpm', ['prisma', 'generate'], { cwd });
      break;
    case 'reset':
      await sh('pnpm', ['prisma', 'migrate', 'reset'], { cwd });
      break;
    case 'studio':
      await sh('pnpm', ['prisma', 'studio'], { cwd });
      break;
    case 'seed':
      await sh('pnpm', ['run', 'seed'], { cwd });
      break;
  }
}
```

### **4. OpenAPI ëª…ë ¹ì–´ (`openapi`)**

#### **ì§€ì›í•˜ëŠ” ì•¡ì…˜**

```typescript
type OpenapiAction = 'validate' | 'bundle' | 'types' | 'client' | 'all';
```

#### **ê²€ì¦ (Validation)**

```typescript
if (action === 'validate' || action === 'all') {
  await sh(
    'pnpm',
    ['-w', 'exec', 'npx', '-y', '@apidevtools/swagger-cli@4.0.4', 'validate', OPENAPI_ROOT],
    { cwd: ROOT }
  );
}
```

**ì‚¬ìš© ë„êµ¬**: `@apidevtools/swagger-cli@4.0.4`
**ê²€ì¦ ëŒ€ìƒ**: `apps/api/openapi/root.yaml`

#### **ë²ˆë“¤ë§ (Bundling)**

```typescript
if (action === 'bundle' || action === 'all') {
  await sh(
    'pnpm',
    [
      '-w',
      'exec',
      'npx',
      '-y',
      '@apidevtools/swagger-cli@4.0.4',
      'bundle',
      OPENAPI_ROOT,
      '--type',
      'yaml',
      '-o',
      OPENAPI_BUNDLE_OUT,
    ],
    { cwd: ROOT }
  );
}
```

**ì…ë ¥**: `apps/api/openapi/root.yaml`
**ì¶œë ¥**: `apps/api/openapi.yaml`

#### **íƒ€ì… ìƒì„± (Types)**

```typescript
if (action === 'types' || action === 'all') {
  await sh('pnpm', ['--filter', '@ai-next/api', 'run', 'gen:openapi:types'], { cwd: ROOT });
}
```

**ì‹¤í–‰**: `@ai-next/api` íŒ¨í‚¤ì§€ì˜ `gen:openapi:types` ìŠ¤í¬ë¦½íŠ¸

#### **í´ë¼ì´ì–¸íŠ¸ ìƒì„± (Client)**

```typescript
if (action === 'client' || action === 'all') {
  await sh('pnpm', ['--filter', '@ai-next/api', 'run', 'gen:openapi:client'], { cwd: ROOT });
}
```

**ì‹¤í–‰**: `@ai-next/api` íŒ¨í‚¤ì§€ì˜ `gen:openapi:client` ìŠ¤í¬ë¦½íŠ¸

### **5. ìŠ¤íƒ ëª…ë ¹ì–´ (`stack`)**

#### **ì§€ì›í•˜ëŠ” ì•¡ì…˜**

```typescript
type StackAction = 'up' | 'down' | 'logs';
```

#### **ëª…ë ¹ì–´ ì˜µì…˜**

```typescript
program
  .command('stack')
  .description('ë¡œì»¬ ì¸í”„ë¼(docker compose) - infrastructure/local ê¸°ì¤€')
  .argument('[action]', 'up|down|logs', 'up')
  .option('-f, --file <path...>', 'compose íŒŒì¼ ê²½ë¡œ(ë‹¤ì¤‘ ì§€ì • ê°€ëŠ¥)')
  .option('-p, --profile <name...>', 'compose profile')
  .option('-s, --service <name...>', 'íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ëŒ€ìƒ')
  .action(async (action, opts) => {
    await cmdStack(action, opts);
  });
```

#### **ì›Œí‚¹ ë””ë ‰í† ë¦¬ íƒì§€**

```typescript
function resolveCwd(): string {
  // 1) í™˜ê²½ë³€ìˆ˜ override
  const fromEnv = process.env.ai_INFRA_DIR;
  if (fromEnv && fs.existsSync(fromEnv)) return path.resolve(fromEnv);

  // 2) ì‹¤í–‰ ìœ„ì¹˜ë¡œë¶€í„° ë£¨íŠ¸ íƒì§€ â†’ infrastructure/local
  const repoRoot = findRepoRoot(process.cwd());
  const infra = path.join(repoRoot, 'infrastructure', 'local');
  if (fs.existsSync(infra)) return infra;

  // 3) ê¸°ì¡´ ìƒìˆ˜ fallback
  if (fs.existsSync(aiG_INFRA)) return aiG_INFRA;

  // 4) ìµœí›„ ë£¨íŠ¸
  return ROOT;
}
```

**íƒì§€ ìš°ì„ ìˆœìœ„:**

1. `ai_INFRA_DIR` í™˜ê²½ë³€ìˆ˜
2. `infrastructure/local` ë””ë ‰í† ë¦¬
3. ìƒìˆ˜ `aiG_INFRA`
4. ë£¨íŠ¸ ë””ë ‰í† ë¦¬

#### **Compose íŒŒì¼ íƒì§€**

```typescript
function findComposeFiles(cwd: string, specified?: string | string[]) {
  if (specified && arr(specified).length) return arr(specified);
  const cands = ['compose.yaml', 'compose.yml', 'docker-compose.yaml', 'docker-compose.yml'];
  return cands.filter(f => fs.existsSync(path.join(cwd, f)));
}
```

**ì§€ì› íŒŒì¼ í˜•ì‹:**

- `compose.yaml` (ìµœì‹ )
- `compose.yml`
- `docker-compose.yaml`
- `docker-compose.yml`

#### **Docker Compose ëª…ë ¹ì–´ êµ¬ì„±**

```typescript
const base = [
  'compose',
  ...files.flatMap(f => ['-f', f]),
  ...arr(opts.profile).flatMap(p => ['--profile', p]),
];

// up: ë°±ê·¸ë¼ìš´ë“œ ì‹œì‘
await sh('docker', [...base, 'up', '-d', ...services], { cwd });

// down: ì„œë¹„ìŠ¤ ì¤‘ì§€
await sh('docker', [...base, 'down'], { cwd });

// logs: ì‹¤ì‹œê°„ ë¡œê·¸
await sh('docker', [...base, 'logs', '-f', ...services], { cwd });
```

### **6. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤**

#### **í™˜ê²½ë³€ìˆ˜ ë¡œë”© (`env.ts`)**

```typescript
export function loadEnvMerged(cwd: string, nodeEnv = process.env.NODE_ENV ?? 'development'): Dict {
  const files = [
    '.env', // ê¸°ë³¸
    '.env.local', // ë¡œì»¬ ì˜¤ë²„ë¼ì´ë“œ
    `.env.${nodeEnv}`, // í™˜ê²½ë³„
    `.env.${nodeEnv}.local`, // í™˜ê²½ë³„ ë¡œì»¬
  ].map(f => path.join(cwd, f));

  const merged: Dict = {};
  // íŒŒì¼ ìˆœì„œëŒ€ë¡œ ë³‘í•© (ë‚˜ì¤‘ ê²ƒì´ ìš°ì„ )
  for (const f of files) Object.assign(merged, loadFile(f));
  // process.env ìµœìš°ì„ 
  for (const [k, v] of Object.entries(process.env)) {
    if (typeof v === 'string') merged[k] = v;
  }
  return merged;
}
```

**í™˜ê²½ë³€ìˆ˜ ìš°ì„ ìˆœìœ„:**

1. `.env` (ê¸°ë³¸)
2. `.env.local` (ë¡œì»¬ ì˜¤ë²„ë¼ì´ë“œ)
3. `.env.{NODE_ENV}` (í™˜ê²½ë³„)
4. `.env.{NODE_ENV}.local` (í™˜ê²½ë³„ ë¡œì»¬)
5. `process.env` (ì‹œìŠ¤í…œ í™˜ê²½ë³€ìˆ˜, ìµœìš°ì„ )

#### **ê²½ë¡œ ìƒìˆ˜ (`paths.ts`)**

```typescript
// ë™ì ìœ¼ë¡œ ê³„ì‚° (ì „ì—­ ë§í¬/ë¡œì»¬ ì‹¤í–‰ ëª¨ë‘ ì»¤ë²„)
export const ROOT = findRepoRoot(process.cwd());
export const aiG_API = path.join(ROOT, 'apps', 'api-server');
export const aiG_PRISMA = path.join(ROOT, 'packages', 'prisma');
export const aiG_SHARED = path.join(ROOT, 'packages', 'shared');
export const aiG_INFRA = path.join(ROOT, 'infrastructure', 'local');

export const OPENAPI_ROOT = path.join(aiG_API, 'openapi', 'root.yaml');
export const OPENAPI_BUNDLE_OUT = path.join(aiG_API, 'openapi.yaml');
```

#### **ëª…ë ¹ì–´ ì‹¤í–‰ (`exec.ts`)**

```typescript
export async function sh(
  cmd: string,
  args: string[],
  opts: { cwd?: string; stdio?: 'inherit' | 'pipe' } = {}
) {
  const c = await execa(cmd, args, {
    stdio: opts.stdio ?? 'inherit',
    cwd: opts.cwd,
  });
  return c.exitCode;
}
```

**íŠ¹ì§•:**

- **`execa` ì‚¬ìš©**: Node.jsì˜ `child_process` ëŒ€ì‹  ë” ê°•ë ¥í•œ `execa` ì‚¬ìš©
- **ê¸°ë³¸ stdio**: `inherit`ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ì‹¤ì‹œê°„ ì¶œë ¥
- **ì›Œí‚¹ ë””ë ‰í† ë¦¬**: `cwd` ì˜µì…˜ìœ¼ë¡œ ì‹¤í–‰ ìœ„ì¹˜ ì œì–´

## ğŸ¯ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### **1. ê°œë°œ í™˜ê²½ ì´ˆê¸° ì„¤ì •**

```bash
# 1. í™˜ê²½ë³€ìˆ˜ í™•ì¸
ai env --check

# 2. ë¡œì»¬ ì¸í”„ë¼ ì‹œì‘
ai stack up

# 3. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
ai db migrate

# 4. Prisma í´ë¼ì´ì–¸íŠ¸ ìƒì„±
ai db generate

# 5. ì‹œë“œ ë°ì´í„° ì‚½ì…
ai db seed
```

### **2. API ê°œë°œ ì›Œí¬í”Œë¡œìš°**

```bash
# 1. OpenAPI ìŠ¤í‚¤ë§ˆ ê²€ì¦
ai openapi validate

# 2. ìŠ¤í‚¤ë§ˆ ë²ˆë“¤ë§
ai openapi bundle

# 3. íƒ€ì… ìƒì„±
ai openapi types

# 4. í´ë¼ì´ì–¸íŠ¸ ìƒì„±
ai openapi client
```

### **3. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë³€ê²½**

```bash
# 1. ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
ai db create --name add_user_profile

# 2. (ì„ íƒ) ë¡œì»¬ DBì— ì¦‰ì‹œ ì ìš©í•˜ë©° ìƒì„±
ai db dev --name add_user_profile

# 3. ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
ai db migrate

# 4. í´ë¼ì´ì–¸íŠ¸ ì¬ìƒì„±
ai db generate

# 5. Prisma Studioë¡œ ë°ì´í„° í™•ì¸
ai db studio
```

### **4. ë¡œì»¬ ì¸í”„ë¼ ê´€ë¦¬**

```bash
# 1. íŠ¹ì • í”„ë¡œíŒŒì¼ë¡œ ì„œë¹„ìŠ¤ ì‹œì‘
ai stack up --profile development

# 2. íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ì‹œì‘
ai stack up --service redis --service postgres

# 3. ë¡œê·¸ ëª¨ë‹ˆí„°ë§
ai stack logs --service api

# 4. ì„œë¹„ìŠ¤ ì¤‘ì§€
ai stack down
```

### **5. í”„ë¡œë•ì…˜ ë°°í¬ ì „ ì¤€ë¹„**

```bash
# 1. í™˜ê²½ë³€ìˆ˜ ê²€ì¦
ai env --check

# 2. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
ai db migrate

# 3. OpenAPI ê²€ì¦
ai openapi validate

# 4. íƒ€ì… ë° í´ë¼ì´ì–¸íŠ¸ ìƒì„±
ai openapi all
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

### **ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…**

- **`ai db reset`**: **ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œ**í•©ë‹ˆë‹¤
- **í”„ë¡œë•ì…˜ í™˜ê²½**: ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”
- **ì‹¤í–‰ ì „**: ë°±ì—…ì„ ê¶Œì¥í•©ë‹ˆë‹¤

### **í™˜ê²½ë³€ìˆ˜**

- **ë¯¼ê°í•œ ì •ë³´**: `.env.local`ì— ì €ì¥í•˜ì„¸ìš”
- **`.env.local`**: `.gitignore`ì— í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤
- **í”„ë¡œë•ì…˜**: ë³„ë„ ê´€ë¦¬ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ì„¸ìš”

### **Docker Compose**

- **`ai stack`**: ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì˜ `docker-compose.yml`ì„ ì‚¬ìš©í•©ë‹ˆë‹¤
- **í•„ìš”í•œ ì„œë¹„ìŠ¤**: ì •ì˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”
- **ê²½ë¡œ íƒì§€**: `ai_INFRA_DIR` í™˜ê²½ë³€ìˆ˜ë¡œ ì˜¤ë²„ë¼ì´ë“œ ê°€ëŠ¥

### **OpenAPI**

- **ì˜ì¡´ì„±**: `@ai-next/api` íŒ¨í‚¤ì§€ì˜ ìŠ¤í¬ë¦½íŠ¸ì— ì˜ì¡´í•©ë‹ˆë‹¤
- **ìŠ¤í‚¤ë§ˆ ê²€ì¦**: `@apidevtools/swagger-cli` í•„ìš”í•©ë‹ˆë‹¤
- **íŒŒì¼ ê²½ë¡œ**: `apps/api/openapi/root.yaml` ê¸°ì¤€ì…ë‹ˆë‹¤

## ğŸ”— ê´€ë ¨ ë§í¬

- [Commander.js](https://github.com/tj/commander.js) - CLI í”„ë ˆì„ì›Œí¬
- [Prisma](https://www.prisma.io/) - ë°ì´í„°ë² ì´ìŠ¤ ORM
- [OpenAPI](https://swagger.io/specification/) - API ëª…ì„¸
- [Docker Compose](https://docs.docker.com/compose/) - ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
- [dotenv](https://github.com/motdotla/dotenv) - í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬
- [execa](https://github.com/sindresorhus/execa) - í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰

## ğŸ“ ë¼ì´ì„¼ìŠ¤

ISC

---

**ê°œë°œíŒ€**: InquAire Team  
**ë²„ì „**: 0.1.0  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2024ë…„
